params:
  username: string
  groups: array string
...

if !params.groups.empty?
  groups = params.groups.join(",")
  out, err, status = shell 'sudo usermod -G {{groups}} {{ params.username }}'.mustache
  success = status == 0
  groups = if success && m = /#{params.username} : (.*)/.match(out)
    m[1].split(" ")
  end
end

{
  success: success,
}
